# Дизайн пользовательского интерфейса

## Обзор

Приложение использует темную тему, стилизованную под игру Revelation Online. Дизайн основан на скриншотах из игры и включает темные фоны и современные UI элементы.

## Цветовая схема

### Основные цвета

- **Темный фон:** `#1A1A1A` - основной фон приложения
- **Очень темный фон:** `#0F0F0F` - фон для AppBar и BottomNavigationBar
- **Фон карточек:** `#2A2A2A` - фон для карточек и полей ввода
- **Основной текст:** `#FFFFFF` - белый цвет для основного текста
- **Вторичный текст:** `#B0B0B0` - серый цвет для вторичного текста
- **Акцентный оранжевый:** `#FF6B35` - для кнопок и акцентов (primary color)
- **Акцентный синий:** `#4A90E2` - для вторичных акцентов

## Компоненты UI

### Карточки фракций

Карточки фракций (`FactionCard`) имеют следующие особенности:

- **Без цветной полосы** - убрана для более чистого вида
- **Скругленные углы** - радиус 12px
- **Темный фон** - цвет карточки `#2A2A2A`
- **Модульная структура** - состоит из переиспользуемых компонентов
- **Бейджи** - для отображения статуса активностей
- **Иконки** - для валюты и активностей
- **Hover эффект** - при наведении (InkWell)

**Структура карточки:**
```
┌─────────────────────────────────────┐
│ Название              [Заказ] [Работа] │
│ [Progress: 5000/15000]    2 д 5 ч │
│ [Progress: 5000/43000]    2 д 3 ч │
└─────────────────────────────────────┘
```

**Компоненты карточки:**
- `FactionNameDisplay` - отображение названия фракции
- `FactionActivitiesList` - список активностей с бейджами (Заказ, Работа)
- `CurrencyProgressBar` - progress bar валюты с отображением "текущая/нужная" (кликабельно для редактирования)
- `TimeToCurrencyGoalWidget` - компактное отображение времени до цели по валюте в формате "Xд" (только дни, округление вверх)
- `ReputationProgressBar` - progress bar опыта с отображением "текущий/требуемый" (кликабельно для редактирования)
- `TimeToReputationGoalWidget` - компактное отображение времени до цели по репутации в формате "Xд" (только дни, округление вверх, без иконок)
- `ActivityBadge` - отдельный бейдж активности (переиспользуемый)
- `WorkCurrencyBadge` - бейдж валюты с работы (кликабельно для редактирования)

### Страница деталей фракции

Страница редактирования фракции с нижней навигацией (BottomNavigationBar). Кнопка сохранения находится в AppBar.

**Вкладка "Настройки" (index 0):**
- **Блок ежедневных активностей** (`FactionActivitiesBlock`) - галочка "Заказы" и поля ввода для работы (валюта/день и опыт/день). Имеет иконку помощи с пояснением
- **Блок целей** (`FactionGoalsBlock`) - целевой уровень репутации (dropdown с опцией "Не нужна") и галочка "Нужен сертификат". Имеет иконку помощи с пояснением

**Вкладка "Инвентарь" (index 1):**
- **Блок валюты** (`FactionCurrencyBlock`) - валюта (редактируемое через диалог)
- **Блок репутации** (`FactionReputationBlock`) - текущий уровень репутации (dropdown), опыт на уровне (редактируемое через диалог)
- **Блок сертификата** (`FactionCertificateBlock`) - сертификат (чекбокс "Есть сертификат")
- **Секция украшений** (`FactionDecorationsSection`) - компактные карточки с чекбоксами "Куплено" и "Улучшено" для каждого украшения
- **Цветные границы** - для карточек украшений, соответствующие типу украшения

**Примечание:** 
- Валюту можно редактировать из карточки фракции или во вкладке "Инвентарь"
- Галочки и поля ввода отображаются только для тех активностей, которые доступны для фракции согласно статическому списку (`FactionTemplate`)
- В списке целевых уровней репутации отображаются только уровни выше текущего уровня
- При изменении текущего уровня, если целевой уровень стал ниже или равен текущему, он автоматически переключается на следующий доступный уровень

**Цвета для украшений:**
- Уважение: зеленый (`#4CAF50`)
- Почтение: бирюзовый (`#26A69A`)
- Преклонение: синий (`#2196F3`)

### Клуб знатоков

Страница поиска вопросов "Клуба знатоков" (`QuizClubPage`) имеет следующие особенности:

- **Поисковая строка** - компактная поисковая строка в верхней части страницы под AppBar
  - Текстовое поле с иконкой поиска слева
  - Кнопка очистки справа (появляется при наличии текста)
  - Компактный размер (isDense, уменьшенные отступы)
  - Темная тема с фоном карточек
- **Список результатов** - отображается в виде карточек вопросов
  - Поддержка pull-to-refresh для обновления данных
  - Автоматическое обновление при изменении поискового запроса
- **Сообщения** - информативные сообщения для разных состояний:
  - Индикатор загрузки при первой загрузке данных
  - Сообщение "Вопросы не найдены" при пустом списке без поиска
  - Сообщение "Ничего не найдено" при отсутствии результатов поиска
  - Сообщение об ошибке с возможностью повторить загрузку

#### Карточка вопроса

Карточка вопроса (`QuestionCard`) имеет следующую структуру:

```
┌─────────────────────────────────────┐
│ Текст вопроса                       │
│ [Ответ 1] [Ответ 2] [Ответ 3]      │
└─────────────────────────────────────┘
```

**Элементы:**
- **Текст вопроса** - белый цвет, жирный шрифт, 16px
- **Чипсы с ответами** - каждый ответ отображается в виде отдельного чипса (Chip виджет)
  - Оранжевый цвет текста (`#FF6B35`), размер шрифта 12px
  - Легкий оранжевый фон (10% прозрачности)
  - Оранжевая граница (30% прозрачности)
  - Компактный размер с уменьшенными отступами
  - Автоматический перенос на новую строку при необходимости (Wrap виджет)

**Особенности:**
- Если у вопроса несколько ответов, каждый ответ отображается в отдельном чипсе
- Чипсы автоматически переносятся на новую строку, если не помещаются в ширину
- Расстояние между чипсами: 8px по горизонтали и вертикали
- Отступы карточки: 16px со всех сторон
- Вертикальный отступ между вопросом и ответами: 8px

**Дополнительные особенности:**
- Темный фон карточки (`#2A2A2A`)
- Скругленные углы (12px)

### Виджет времени до цели

Компактный виджет отображения времени до достижения цели в карточке фракции. Имеет состояния:

1. **Загрузка** - индикатор загрузки (только при первой загрузке)
2. **Расчет** - отображение времени в компактном формате (только дни, округление вверх, например, "3д")
3. **Достигнуто** - отображение "Цель достигнута" с зеленой галочкой
4. **Нет данных** - сообщение "Нет данных"

**Особенности:**
- **Оптимистичное обновление** - при пересчете показывает предыдущее значение, индикатор загрузки не показывается
- **Автоматический пересчет** - пересчитывается при изменении любых полей, влияющих на расчет (currency, hasOrder, hasWork, hasCertificate, orderCompleted, certificatePurchased, украшения и т.д.)
- Использует `FittedBox` с `BoxFit.scaleDown` для предотвращения переполнения текста

### Поля ввода

Все поля ввода имеют:
- Темный фон (`#2A2A2A`)
- Серую границу в обычном состоянии
- Оранжевую границу при фокусе (2px)
- Скругленные углы (8px)

### Кнопки

- **ElevatedButton** - оранжевый фон, белый текст
- **FloatingActionButton** - оранжевый фон, иконка добавления
- Скругленные углы (8px)
- Padding: 24px горизонтально, 12px вертикально

### Навигация

**Drawer (боковое меню):**
- Темный фон (`#2A2A2A`)
- Заголовок с названием приложения
- Пункты меню: Фракции, Карта
- Выделение текущего раздела

**Страница фракций:**
- Отображает список всех фракций
- Имеет FloatingActionButton для добавления новой фракции

## Типографика

### Размеры шрифтов

- **Заголовки секций:** 18px, жирный
- **Названия фракций:** 18px, жирный
- **Основной текст:** 14-16px, обычный
- **Вторичный текст:** 12-14px, серый
- **Бейджи:** 12px, полужирный

### Стили текста

- Основной текст: белый (`#FFFFFF`)
- Вторичный текст: серый (`#B0B0B0`)
- Акцентный текст: primary color
- Успешные действия: зеленый
- Предупреждения: оранжевый

## Иконки

Приложение использует Material Icons с следующими назначениями:

- `Icons.group` - фракции (в Drawer)
- `Icons.group_outlined` - фракции (в списке)
- `Icons.map` - карта
- `Icons.add` - добавление
- `Icons.delete` - удаление/скрытие фракции
- `Icons.save` - сохранение
- `Icons.settings` - настройки (вкладка)
- `Icons.inventory_2` - инвентарь (вкладка)
- `Icons.menu` - меню (burger)
- `Icons.attach_money` - валюта
- `Icons.check_circle_outline` - ежедневные активности
- `Icons.shopping_cart` - заказ
- `Icons.work_outline` - работа
- `Icons.star` - репутация/украшения
- `Icons.verified` - сертификат
- `Icons.flag` - цели
- `Icons.arrow_drop_down` - выпадающий список
- `Icons.trending_up` - опыт
- `Icons.help_outline` - помощь
- `Icons.block` - блокировка (в progress bar)
- `Icons.check` - достижение цели (в progress bar)
- `Icons.quiz` - Клуб знатоков (в Drawer)
- `Icons.search` - поиск (в поисковой строке)
- `Icons.clear` - очистка (в поисковой строке)
- `Icons.search_off` - отсутствие результатов поиска
- `Icons.error_outline` - ошибка загрузки

## Скрытие фракций

Фракции можно скрывать свайпом влево или через кнопку в деталях:

- **Подтверждение** - перед скрытием показывается компактный диалог подтверждения
- **Красный фон** - при свайпе показывается красный фон с иконкой удаления
- **Скругленные углы** - фон скрытия имеет скругленные углы, соответствующие карточке
- **Упрощенный диалог** - диалог имеет минимальные отступы и упрощенный текст
- **Восстановление** - скрытые фракции можно снова показать через диалог добавления фракции

## Изменение порядка фракций

Фракции можно переупорядочивать через drag-and-drop:

- **Перетаскивание** - зажмите карточку и перетащите на новую позицию
- **Прозрачный фон** - при перетаскивании фон элемента не меняется (через `proxyDecorator`)
- **Оптимистичное обновление** - UI обновляется мгновенно, затем синхронизируется с БД
- **Автосохранение** - порядок автоматически сохраняется в базе данных

## Обновление списка

Список фракций можно обновить через pull-to-refresh:

- **Свайп вниз** - потяните список вниз для обновления
- **Индикатор обновления** - показывается стандартный индикатор Flutter
- **Автоматическое обновление** - список перезагружается из базы данных

## Оптимистичные обновления

Приложение использует оптимистичные обновления для улучшения UX:

- **Обновление фракции** (`UpdateFactionEvent`) - изменения отображаются мгновенно, сохранение в БД происходит в фоне
- **Изменение порядка** (`ReorderFactionsEvent`) - порядок обновляется мгновенно, сохранение в БД происходит в фоне
- **Восстановление при ошибке** - при ошибке сохранения состояние автоматически восстанавливается из БД
- **Виджет времени по валюте** (`TimeToCurrencyGoalWidget`) - показывает предыдущее значение при пересчете, индикатор загрузки только при первой загрузке, отображается во второй строке справа от progress bar валюты
- **Виджет времени по репутации** (`TimeToReputationGoalWidget`) - показывает предыдущее значение при пересчете, индикатор загрузки только при первой загрузке, отображается в третьей строке справа от progress bar опыта

## Адаптивность

Приложение разработано с учетом адаптивности:

- Карточки имеют отступы 16px по горизонтали
- Вертикальные отступы между элементами: 8-24px
- Скругления углов: 8-12px
- Минимальные размеры для касаний: 48x48px

## Анимации

- Плавные переходы при навигации
- Hover эффекты на интерактивных элементах
- Анимация появления карточек в списке
- Плавное изменение состояния чекбоксов

## Доступность

- Высокий контраст текста на фоне
- Четкие границы интерактивных элементов
- Иконки с текстовыми подписями
- Достаточные размеры для касаний




