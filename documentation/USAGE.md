# Руководство пользователя

## Начало работы

### Первый запуск

1. При первом запуске приложения автоматически создается база данных
2. Все настройки (цены, валюты) хранятся как константы в коде приложения

## Работа с фракциями

### Добавление фракции в список

Приложение содержит статический список всех 13 фракций игры. Все фракции изначально скрыты.

1. Откройте вкладку **"Фракции"**
2. Нажмите на кнопку **"+"** в правом нижнем углу
3. В открывшемся диалоге выберите фракцию из списка скрытых фракций
4. Фракция будет добавлена в список и станет видимой

**Примечание:** 
- Валюту и валюту с работы можно указать позже, нажав на соответствующие элементы в карточке фракции
- Фракции с заказами и работой: Жители Сулана, Фалмари, Грибной народ, Озёрная деревня, Медведи, Крылатые, Монастырь Сноу-Шу, Северные волки, Императорская академия
- Фракции только с работой: Кнотты, Калахар, Астерион, Лисы
- Наличие заказов, работ и сертификатов определяется статическим списком фракций и настраивается для каждой фракции

### Редактирование фракции

1. Откройте вкладку **"Фракции"**
2. Нажмите на карточку нужной фракции
3. Измените необходимые параметры (название фракции отображается в заголовке и не редактируется)
4. Нажмите **"Сохранить"**

**Примечание:** 
- Для фракций без заказов (Кнотты, Калахар, Астерион, Лисы) галочка "Заказы" не отображается на странице редактирования
- Для фракций без работы галочка "Работы" не отображается на странице редактирования
- Для фракций без сертификата галочка "Сертификат" не отображается на странице редактирования
- Наличие заказов, работ и сертификатов определяется статическим списком фракций (`FactionTemplate`) и настраивается для каждой фракции

### Скрытие фракции

**Способ 1: Свайп**
1. Откройте список фракций
2. Смахните карточку фракции влево
3. Подтвердите скрытие в диалоге

**Способ 2: Кнопка в деталях**
1. Откройте страницу редактирования фракции
2. Нажмите на кнопку удаления в AppBar
3. Подтвердите скрытие в диалоге

**Примечание:** Фракция не удаляется из базы данных, а только скрывается из списка. Её можно снова показать через диалог добавления фракции.

### Изменение порядка фракций

1. Откройте список фракций
2. Зажмите карточку фракции и перетащите её на новую позицию
3. Порядок автоматически сохранится в базе данных

**Примечание:** Порядок сохраняется между сеансами приложения.

### Обновление списка фракций

Список фракций можно обновить вручную:

1. Откройте список фракций
2. Потяните список вниз (свайп вниз)
3. Список автоматически перезагрузится из базы данных

**Примечание:** Изменения отображаются мгновенно благодаря оптимистичным обновлениям. При обновлении фракции или изменении порядка UI обновляется сразу, сохранение в БД происходит в фоне.

### Ежедневные активности

Каждый день в 0:00 по московскому времени отметки о выполнении заказов и работ автоматически сбрасываются.

Вы можете вручную отметить выполнение:
- **Заказ выполнен** - нажмите на бейдж "Заказ" в карточке фракции
- **Работа выполнена** - нажмите на бейдж "Работа" в карточке фракции
- **Сертификат куплен** - нажмите на иконку сертификата справа от валюты в карточке фракции

**На странице редактирования фракции:**
- Блок "Ежедневные активности" с галочками:
  - "Заказы" - показывает, учитывать ли заказы в калькуляторе времени. Если галочка включена, бейдж "Заказ" отображается в карточке фракции
  - "Работы" - показывает, учитывать ли работу в калькуляторе времени. Если галочка включена, бейдж "Работа" отображается в карточке фракции
- Блок "Сертификат" с галочкой:
  - "Сертификат" - показывает, есть ли сертификат во фракции. Если галочка включена, сертификат учитывается в расчете времени до цели

## Расчет времени до цели

### Что такое цель?

Главная цель фракции - **купить сертификат**. Для этого необходимо:
1. Купить все три украшения (Уважение, Почтение, Преклонение)
2. Улучшить все три украшения
3. Купить сертификат

### Как работает расчет?

Виджет **"Время до цели"** автоматически рассчитывает, сколько времени осталось до достижения цели. Отображается в компактном виде прямо в карточке фракции в формате "X д Y ч Z м":

1. Рассчитывается общая стоимость всех некупленных украшений и улучшений
2. Добавляется стоимость сертификата (если он еще не куплен)
3. Вычитается текущее количество валюты
4. Рассчитывается потенциальный доход в день (независимо от отметок выполнения):
   - Валюта за заказ (только если `hasOrder = true`) - среднее арифметическое из массива значений валюты за заказы для данной фракции (`FactionTemplate.orderCurrencyValues`). Значения могут варьироваться в разные дни, поэтому используется среднее для более точного расчета
   - Валюта за работу (только если `hasWork = true`) - фиксированная сумма из настроек (`AppSettings.factions.currencyPerWork`)
5. Вычисляется время: `(нужная валюта) / (валюта в день)`

**Примечание:** Время до цели автоматически пересчитывается при изменении любых полей, влияющих на расчет (валюта, hasOrder, hasWork, hasCertificate, статус украшений и т.д.)

### Когда расчет недоступен?

Расчет не будет показан, если:
- Нет дохода в день (во фракции `hasOrder = false` и `hasWork = false`)

## Украшения

В каждой фракции можно купить три украшения:

1. **Уважение**
2. **Почтение**
3. **Преклонение**

Каждое украшение можно:
- **Купить** - за валюту фракции
- **Улучшить** - за фиксированную стоимость (значения хранятся как константы в коде)

## Сертификат

Сертификат можно купить только после того, как:
1. Куплены все три украшения
2. Улучшены все три украшения

**Управление сертификатом:**
- На странице редактирования фракции сертификат вынесен в отдельный блок "Сертификат"
- Галочка "Сертификат" показывает, есть ли сертификат во фракции (определяется статическим списком фракций)
- Если во фракции нет сертификата согласно шаблону, галочка не отображается
- Сертификат учитывается в расчете времени до цели только если `hasCertificate = true`

## Навигация

Приложение использует двухуровневую навигацию:

**Уровень 1: Drawer (боковое меню)**
- Открывается по нажатию на кнопку меню (burger) в AppBar
- Содержит два раздела:
  1. **Фракции** - открывает страницу фракций
  2. **Карта** - открывает страницу карты (заглушка)

**Уровень 2: Страница фракций**
- Отображается список всех фракций с кнопкой добавления

### Редактирование валюты

Валюту можно редактировать прямо из карточки фракции:

1. **Валюта фракции** - нажмите на отображение валюты справа от названия фракции
2. **Валюта с работы** - нажмите на бейдж "Работа" или значение валюты в списке активностей (открывается диалог редактирования, не переключает статус выполнения)

Откроется диалог для ввода нового значения. При открытии диалога весь текст автоматически выделяется для быстрой замены.

## Советы

1. **Регулярно обновляйте валюту** - нажимайте на валюту в карточке фракции для быстрого обновления
2. **Отмечайте активности** - отмечайте выполнение заказов и покупку сертификата, нажимая на бейджи/иконки в карточке фракции
3. **Наличие заказов, работ и сертификатов** - определяется статическим списком фракций (`FactionTemplate`) и настраивается для каждой фракции. Для фракций без соответствующих активностей соответствующие галочки не отображаются на странице редактирования
4. **Проверяйте время до цели** - время до цели отображается прямо в карточке фракции для быстрого обзора
6. **Скрытие фракции** - для скрытия фракции используйте свайп по карточке или кнопку в деталях. Фракция не удаляется, её можно снова показать
7. **Изменение порядка** - перетаскивайте карточки для изменения порядка отображения фракций
8. **Валюта с работы** - указывайте валюту с работы для более точного расчета времени до цели
9. **Обновление списка** - потяните список вниз для обновления данных из базы
10. **Мгновенные обновления** - изменения отображаются мгновенно, сохранение происходит автоматически в фоне

