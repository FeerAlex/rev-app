# Руководство пользователя

## Начало работы

### Первый запуск

1. При первом запуске приложения автоматически создается база данных
2. Все настройки (цены, валюты) хранятся как константы в коде приложения

## Работа с фракциями

### Добавление фракции в список

Приложение содержит статический список всех 13 фракций игры. Все фракции изначально скрыты.

1. Откройте вкладку **"Фракции"**
2. Нажмите на кнопку **"+"** в правом нижнем углу
3. В открывшемся диалоге выберите фракцию из списка скрытых фракций
4. Фракция будет добавлена в список и станет видимой

**Примечание:** 
- Валюту можно указать позже, нажав на отображение валюты в карточке фракции
- Работа настраивается через поля ввода на странице редактирования фракции
- Фракции с заказами и работой: Жители Сулана, Фалмари, Грибной народ, Озёрная деревня, Медведи, Крылатые, Монастырь Сноу-Шу, Северные волки, Императорская академия
- Фракции только с работой: Кнотты, Калахар, Астерион, Лисы
- Наличие заказов, работ и сертификатов определяется статическим списком фракций и настраивается для каждой фракции

### Редактирование фракции

1. Откройте вкладку **"Фракции"**
2. Нажмите на карточку нужной фракции
3. Измените необходимые параметры (название фракции отображается в заголовке и не редактируется)
4. Нажмите **"Сохранить"**

**Примечание:** 
- Для фракций без заказов (Кнотты, Калахар, Астерион, Лисы) галочка "Заказы" не отображается на странице редактирования
- Для фракций без работы поля ввода для работы не отображаются на странице редактирования
- Для фракций без сертификата галочка "Сертификат" не отображается на странице редактирования
- Наличие заказов, работ и сертификатов определяется статическим списком фракций (`FactionTemplate`) и настраивается для каждой фракции

### Скрытие фракции

**Способ 1: Свайп**
1. Откройте список фракций
2. Смахните карточку фракции влево
3. Подтвердите скрытие в диалоге

**Способ 2: Кнопка в деталях**
1. Откройте страницу редактирования фракции
2. Нажмите на кнопку удаления в AppBar
3. Подтвердите скрытие в диалоге

**Примечание:** Фракция не удаляется из базы данных, а только скрывается из списка. Её можно снова показать через диалог добавления фракции.

### Изменение порядка фракций

1. Откройте список фракций
2. Зажмите карточку фракции и перетащите её на новую позицию
3. Порядок автоматически сохранится в базе данных

**Примечание:** Порядок сохраняется между сеансами приложения.

### Обновление списка фракций

Список фракций можно обновить вручную:

1. Откройте список фракций
2. Потяните список вниз (свайп вниз)
3. Список автоматически перезагрузится из базы данных

**Примечание:** Изменения отображаются мгновенно благодаря оптимистичным обновлениям. При обновлении фракции или изменении порядка UI обновляется сразу, сохранение в БД происходит в фоне.

### Ежедневные активности

Каждый день в 0:00 по московскому времени отметки о выполнении заказов и работ автоматически сбрасываются.

Вы можете вручную отметить выполнение:
- **Заказ выполнен** - нажмите на бейдж "Заказ" в карточке фракции
- **Работа выполнена** - нажмите на бейдж "Работа" в карточке фракции
- **Сертификат куплен** - нажмите на иконку сертификата справа от валюты в карточке фракции

**На странице редактирования фракции:**

Страница редактирования разделена на две вкладки (нижняя навигация):

**Вкладка "Настройки":**
- Блок "Ежедневные активности" (рядом с заголовком есть иконка помощи с пояснением):
  - "Заказы" (галочка) - показывает, учитывать ли заказы в калькуляторе времени. Если галочка включена, бейдж "Заказ" отображается в карточке фракции. Доступна только для фракций с заказами согласно статическому списку
  - "Работа" (поля ввода) - два поля для указания валюты и опыта, которые вы получаете за работу каждый день:
    - "Валюта/день" - валюта за работу в день
    - "Опыт/день" - опыт за работу в день
    - Можно указать только валюту, только опыт, или оба значения
    - Если оба поля пустые или равны 0, работа не учитывается в расчетах
    - Если хотя бы одно поле > 0, бейдж "Работа" отображается в карточке фракции
    - Доступны только для фракций с работой согласно статическому списку
- Блок "Цели" (рядом с заголовком есть иконка помощи с пояснением):
  - "Целевой уровень" (dropdown) - выберите уровень репутации, которого хотите достичь, или "Не нужна", если не ставите цель по репутации. В списке отображаются только уровни выше текущего уровня
  - "Нужен сертификат" (галочка) - включите, если хотите купить сертификат. Это учитывается при расчете времени до цели по валюте

**Вкладка "Инвентарь":**
- Блок "Инвентарь":
  - "Валюта" - текущее количество валюты (редактируемое через диалог)
  - "Текущий уровень" - текущий уровень репутации (dropdown)
  - "Опыт на уровне" - опыт на текущем уровне (редактируемое через диалог)
  - "Сертификат" (галочка) - укажите, есть ли у вас сертификат. Отображается только для фракций с сертификатом согласно статическому списку
- Блок "Украшения":
  - Три украшения (Уважение, Почтение, Преклонение) с чекбоксами "Куплено" и "Улучшено"

**Условия отображения блоков во вкладке "Инвентарь":**
- **Блок "Репутация"** (текущий уровень и опыт) отображается только если во вкладке "Настройки" установлен целевой уровень репутации (не выбрано "Не нужна")
- **Блоки "Валюта", "Украшения" и "Сертификат"** отображаются только если во вкладке "Настройки" включена галочка "Нужен сертификат"
- Если цели не установлены, соответствующие блоки не отображаются во вкладке "Инвентарь"

## Расчет времени до цели

### Что такое цель?

Цели во фракции настраиваются во вкладке "Настройки" в блоке "Цели":
1. **Целевой уровень репутации** - уровень отношения, которого вы хотите достичь (или "Не нужна", если не ставите цель)
2. **Нужен сертификат** - включите галочку, если хотите купить сертификат

Для покупки сертификата необходимо:
1. Купить все три украшения (Уважение, Почтение, Преклонение)
2. Улучшить все три украшения
3. Купить сертификат

### Как работает расчет?

Виджеты **"Время до цели"** автоматически рассчитывают, сколько времени осталось до достижения цели. Отображаются в компактном виде прямо в карточке фракции в формате "Xд" (только дни, округление вверх):
- **Время до цели по валюте** - отображается справа вверху карточки
- **Время до цели по репутации** - отображается справа от progress bar опыта внизу карточки

**Условия отображения progress bars в карточке фракции:**
- **Строка с progress bars** (вторая строка карточки) отображается только если установлена хотя бы одна цель:
  - Включена галочка "Нужен сертификат" во вкладке "Настройки"
  - ИЛИ установлен целевой уровень репутации (не выбрано "Не нужна")
- **Progress bar валюты** отображается только если включена галочка "Нужен сертификат". Показывает прогресс по валюте для покупки украшений и сертификата
- **Progress bar опыта** отображается только если установлен целевой уровень репутации. Показывает прогресс по опыту репутации до целевого уровня
- Если обе цели не установлены, строка с progress bars не отображается в карточке фракции

1. Рассчитывается общая стоимость всех некупленных украшений и улучшений
2. Добавляется стоимость сертификата (только если галочка "Нужен сертификат" включена и сертификат еще не куплен)
3. Вычитается текущее количество валюты
4. Рассчитывается потенциальный доход в день (независимо от отметок выполнения):
   - Валюта за заказ (только если `ordersEnabled = true` и фракция имеет заказы согласно статическому списку) - среднее арифметическое валюты из награды за заказы для данной фракции (`FactionTemplate.orderReward`). Значения могут варьироваться в разные дни, поэтому используется среднее для более точного расчета
   - Валюта за работу (только если `workReward.currency > 0`) - значение из `faction.workReward.currency`
5. Вычисляется время: `(нужная валюта) / (валюта в день)`

**Примечание:** Время до цели автоматически пересчитывается при изменении любых полей, влияющих на расчет (валюта, ordersEnabled, workReward, hasCertificate, статус украшений и т.д.)

### Когда расчет недоступен?

Расчет не будет показан, если:
- **Для валюты:** Нет дохода в день (во фракции заказы отключены или не настроены, и работа не настроена (оба поля ввода пустые или равны 0)), или цель не установлена (не нужен сертификат и все украшения уже куплены/улучшены)
- **Для репутации:** Целевой уровень не установлен (выбрано "Не нужна"), или нет дохода опыта в день (во фракции заказы отключены или не настроены, и работа не настроена с опытом > 0)

## Украшения

В каждой фракции можно купить три украшения:

1. **Уважение**
2. **Почтение**
3. **Преклонение**

Каждое украшение можно:
- **Купить** - за валюту фракции
- **Улучшить** - за фиксированную стоимость (значения хранятся как константы в коде)

## Сертификат

Сертификат можно купить только после того, как:
1. Куплены все три украшения
2. Улучшены все три украшения

**Управление сертификатом:**
- Во вкладке "Инвентарь" в блоке "Инвентарь" галочка "Сертификат" показывает, есть ли у вас сертификат (куплен ли он)
- Во вкладке "Настройки" в блоке "Цели" галочка "Нужен сертификат" показывает, нужен ли сертификат как цель (учитывается в расчете времени до цели по валюте)
- Если во фракции нет сертификата согласно статическому списку, галочка "Сертификат" не отображается во вкладке "Инвентарь"
- Сертификат учитывается в расчете времени до цели по валюте только если галочка "Нужен сертификат" включена и сертификат еще не куплен

## Навигация

Приложение использует двухуровневую навигацию:

**Уровень 1: Drawer (боковое меню)**
- Открывается по нажатию на кнопку меню (burger) в AppBar
- Содержит два раздела:
  1. **Фракции** - открывает страницу фракций
  2. **Карта** - открывает страницу карты (заглушка)

**Уровень 2: Страница фракций**
- Отображается список всех фракций с кнопкой добавления

### Редактирование валюты

Валюту можно редактировать прямо из карточки фракции:

1. **Валюта фракции** - нажмите на отображение валюты справа от названия фракции

Откроется диалог для ввода нового значения. При открытии диалога весь текст автоматически выделяется для быстрой замены.

**Примечание:** Валюта и опыт за работу настраиваются через поля ввода на странице редактирования фракции в блоке "Ежедневные активности".

## Репутация и уровни отношения

### Уровни отношения

В игре есть 7 уровней отношения к фракции:
- **Равнодушие** - начальный уровень (0-16000 опыта)
- **Дружелюбие** - 0-43000 опыта на уровне
- **Уважение** - 0-48000 опыта на уровне
- **Почтение** - 0-80000 опыта на уровне
- **Преклонение** - 0-105000 опыта на уровне (стандартное) или 0-115000 (для некоторых фракций)
- **Обожествление** - 0-170000 опыта на уровне (стандартное) или 0-180000 (для некоторых фракций)
- **Максимальный** - достигнут после полного заполнения Обожествления

**Важно:** Опыт накапливается с 0 на каждом уровне. Когда достигается требуемый опыт, уровень меняется и счетчик снова начинается с 0.

### Отображение репутации

В карточке фракции отображается:
- **Progress bar** с названием текущего уровня
- **Формат "текущий/требуемый"** (например, "5000/43000")
- **Цвет progress bar** соответствует уровню отношения

Нажмите на progress bar, чтобы открыть страницу деталей для редактирования.

### Редактирование репутации

На странице деталей фракции во вкладке "Инвентарь" в блоке "Инвентарь":
1. **Текущий уровень** - выберите уровень отношения из списка (как видите в игре)
2. **Опыт на уровне** - введите опыт, который вы накопили на текущем уровне (как видите в игре)

Во вкладке "Настройки" в блоке "Цели":
3. **Целевой уровень** - выберите уровень, до которого хотите дойти, или "Не нужна", если не ставите цель по репутации. В списке отображаются только уровни выше текущего уровня

**Пример:** Если в игре вы видите "Дружелюбие 5000/43000", то:
- Текущий уровень: Дружелюбие
- Опыт на уровне: 5000

**Примечание:** При изменении текущего уровня, если целевой уровень стал ниже или равен текущему, он автоматически переключается на следующий доступный уровень (минимальный уровень выше текущего).

### Расчет времени до целевого уровня

Приложение автоматически рассчитывает время до достижения выбранного целевого уровня:
- Учитывается опыт за заказы (среднее арифметическое из `FactionTemplate.orderReward`) - только если заказы включены (`ordersEnabled = true`)
- Учитывается опыт за работу (только если `workReward.exp > 0`) - значение из `faction.workReward.exp`
- Время отображается в формате "Xд" (только дни, округление вверх) справа от progress bar опыта в карточке фракции
- Если цель уже достигнута, показывается "Цель достигнута"
- Если целевой уровень не установлен (выбрано "Не нужна"), расчет не выполняется

**Примечание:** 
- Расчет учитывает только те источники опыта, которые настроены (заказы включены и фракция имеет заказы согласно статическому списку, или работа настроена с опытом > 0)
- В списке целевых уровней отображаются только уровни выше текущего уровня
- При изменении текущего уровня, если целевой уровень стал ниже или равен текущему, он автоматически переключается на следующий доступный уровень
- Время до цели по репутации отображается только в карточке фракции, не на странице деталей

## Советы

1. **Регулярно обновляйте валюту** - нажимайте на валюту в карточке фракции для быстрого обновления
2. **Отмечайте активности** - отмечайте выполнение заказов и покупку сертификата, нажимая на бейджи/иконки в карточке фракции
3. **Наличие заказов, работ и сертификатов** - определяется статическим списком фракций (`FactionTemplate`) и настраивается для каждой фракции. Для фракций без соответствующих активностей соответствующие галочки не отображаются на странице редактирования
4. **Проверяйте время до цели** - время до цели по валюте и репутации отображается прямо в карточке фракции для быстрого обзора
6. **Скрытие фракции** - для скрытия фракции используйте свайп по карточке или кнопку в деталях. Фракция не удаляется, её можно снова показать
7. **Изменение порядка** - перетаскивайте карточки для изменения порядка отображения фракций
8. **Работа** - указывайте валюту и/или опыт за работу через поля ввода на странице редактирования для более точного расчета времени до цели
9. **Репутация** - указывайте текущий уровень и опыт на уровне точно так, как видите в игре (не суммируйте опыт за все уровни!)
10. **Целевой уровень** - выберите уровень, до которого хотите дойти (не обязательно максимальный). В списке отображаются только уровни выше текущего
11. **Нужен сертификат** - включите галочку, если хотите купить сертификат. Это учитывается в расчете времени до цели по валюте
12. **Вкладки на странице редактирования** - используйте нижнюю навигацию для переключения между вкладками "Настройки" и "Инвентарь"
13. **Обновление списка** - потяните список вниз для обновления данных из базы
14. **Мгновенные обновления** - изменения отображаются мгновенно, сохранение происходит автоматически в фоне
15. **Иконки помощи** - нажмите на иконку "?" рядом с заголовками блоков "Ежедневные активности" и "Цели" для получения подробной информации

